#include <Wire.h>
#include <LiquidCrystal_I2C.h>
#include <Preferences.h>

// SDA = GPIO 21 (Orange), SCL = GPIO 22 (Yellow)
// Standard address is 0x27. If it doesn't work, try 0x3F.
LiquidCrystal_I2C lcd(0x27, 16, 2);
Preferences prefs;

unsigned long lastUpdate = 0;
bool hbState = false;

void setup() {
  Serial.begin(115200);
  Wire.begin(21, 22); 

  lcd.init();
  lcd.backlight();
  lcd.clear();

  prefs.begin("irrigation", false); 
  // Establish baseline memory logging [cite: 29, 30]
  
  lcd.setCursor(0, 0);
  lcd.print("SYSTEM START...");
  delay(2000);
  lcd.clear();
}

void loop() {
  // Update every 500ms to prevent "LCD Flickering"
  if (millis() - lastUpdate > 500) {
    lastUpdate = millis();
    hbState = !hbState;

    // Mock Data for Phase 1 Validation [cite: 28]
    int hA = 2450; int sA = 420; int tA = 22;
    int hB = 2150; int sB = 380; bool pB = true;

    // Line 1: Method A (Flood Baseline) [cite: 9, 12]
    lcd.setCursor(0, 0);
    char buf1[17];
    sprintf(buf1, "A:H%04d S%03d %02dC", hA, sA, tA);
    lcd.print(buf1);

    // Line 2: Method B (Smart Drip) [cite: 10, 16]
    lcd.setCursor(0, 1);
    char buf2[17];
    // This provides visual confirmation of system functionality 
    sprintf(buf2, "B:H%04d S%03d %c%s", hB, sB, (hbState ? '*' : ' '), (pB ? "ON " : "OFF"));
    lcd.print(buf2);
  }
}
